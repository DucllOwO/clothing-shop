// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  email    String  @id @db.VarChar(256)
  password String  @db.VarChar(100)
  is_admin Boolean @default(false)
  User     User[]

  @@map("account")
}

model User {
  id             Int        @id @default(autoincrement())
  firstname      String     @db.VarChar(50)
  lastname       String?    @db.VarChar(50)
  phone_number   String?    @db.Char(10)
  address        String?    @db.VarChar(150)
  avatar         String     @default("https://lggcxbdwmetbsvmtuctl.supabase.co/storage/v1/object/public/avatar/default.png")
  product_viewed String[]
  account        Account    @relation(fields: [email], references: [email])
  email          String     @db.VarChar(256)
  logged_date    DateTime   @default(now()) @db.Timestamptz(6)
  Feedback       Feedback[]
  Review         Review[]
  Cart           Cart[]
  Order          Order[]

  @@map("user")
}

model Feedback {
  id       Int     @id @default(autoincrement())
  content  String?
  rate     Float
  author   User?   @relation(fields: [authorID], references: [id], onDelete: NoAction)
  authorID Int?

  @@map("feedback")
}

model Discount {
  id         Int          @id @default(autoincrement())
  name       String       @default("")
  discount   Float        @default(0)
  Tag        Tag[]
  Collection Collection[]
  Product    Product[]

  @@map("discount")
}

model Tag {
  id         Int       @id @default(autoincrement())
  name       String    @db.VarChar(150)
  discount   Discount? @relation(fields: [discountID], references: [id], onDelete: SetNull)
  discountID Int?
  HaveTag    HaveTag[]

  @@map("tag")
}

model HaveTag {
  id        Int     @id @default(autoincrement())
  tag       Tag     @relation(fields: [tagID], references: [id], onDelete: Cascade)
  tagID     Int
  product   Product @relation(fields: [productID], references: [id], onDelete: Cascade)
  productID Int

  @@map("have_tag")
}

model Collection {
  id         Int       @id @default(autoincrement())
  name       String    @db.VarChar(150)
  discount   Discount? @relation(fields: [discountID], references: [id], onDelete: SetNull)
  discountID Int?
  Product    Product[]

  @@map("collection")
}

model Product {
  id           Int            @id @default(autoincrement())
  name         String         @unique @db.VarChar(256)
  price        Int
  description  String?
  image        String[]
  slug         String         @unique @default("")
  view         Int            @default(0)
  sold         Int            @default(0)
  isActive     Boolean        @default(true)
  discount     Discount?      @relation(fields: [discountID], references: [id], onDelete: SetNull)
  discountID   Int?
  collection   Collection?    @relation(fields: [collectionID], references: [id], onDelete: SetNull)
  collectionID Int?
  Review       Review[]
  Product_item Product_item[]
  HaveTag      HaveTag[]

  @@map("product")
}

model Voucher {
  code        String    @id @db.Char(6)
  name        String    @db.VarChar(150)
  discount    Float     @default(0)
  description String?
  due         DateTime  @db.Date
  Receipt     Receipt[]
  isActive    Boolean   @default(true)

  @@map("voucher")
}

model Receipt {
  id            Int      @id @default(autoincrement())
  date          DateTime @default(now()) @db.Timestamptz(6)
  cost          Int      @default(0)
  status        String   @default("0") @db.Char(1)
  paymentMethod String   @db.VarChar(100)
  voucher       Voucher? @relation(fields: [voucherCode], references: [code], onDelete: NoAction)
  voucherCode   String?  @db.Char(6)
  order         Order    @relation(fields: [orderID], references: [id], onDelete: NoAction)
  orderID       Int

  @@map("receipt")
}

model Review {
  id        Int     @id @default(autoincrement())
  comment   String?
  rate      Float
  author    User    @relation(fields: [authorID], references: [id], onDelete: NoAction)
  authorID  Int
  product   Product @relation(fields: [productID], references: [id], onDelete: NoAction)
  productID Int

  @@map("review")
}

model Product_item {
  id           Int             @id @default(autoincrement())
  color        String          @db.VarChar(100)
  size         String          @db.Char(4)
  quantity     Int
  image        String[]
  product      Product         @relation(fields: [productID], references: [id], onDelete: NoAction)
  productID    Int
  Order_detail Order_detail[]
  ImportDetail Import_detail[]
  Cart         Cart[]

  @@map("product_item")
}

model Cart {
  id           Int          @id @default(autoincrement())
  quantity     Int          @default(1)
  product_item Product_item @relation(fields: [itemID], references: [id], onDelete: Cascade)
  itemID       Int
  owner        User         @relation(fields: [userID], references: [id], onDelete: Cascade)
  userID       Int

  @@map("cart")
}

model Order {
  id           Int            @id @default(autoincrement())
  date         DateTime       @default(now()) @db.Timestamptz(6)
  total_cost   Int            @default(0)
  status       String         @default("0") @db.Char(1)
  firstname    String         @db.VarChar(50)
  lastname     String?        @db.VarChar(50)
  phone_number String?        @db.Char(10)
  address      String?        @db.VarChar(150)
  buyer        User           @relation(fields: [userID], references: [id], onDelete: NoAction)
  userID       Int
  Order_detail Order_detail[]
  Receipt      Receipt[]

  @@map("order")
}

model Order_detail {
  id           Int          @id @default(autoincrement())
  product_item Product_item @relation(fields: [itemID], references: [id], onDelete: NoAction)
  itemID       Int
  order        Order        @relation(fields: [orderID], references: [id], onDelete: NoAction)
  orderID      Int
  quantity     Int          @default(1)

  @@map("order_detail")
}

model Yearly_report {
  year           DateTime         @id @db.Date
  income         Int              @default(0)
  outcome        Int              @default(0)
  profit         Int              @default(0)
  sold_quantity  Int              @default(0)
  Monthly_report Monthly_report[]

  @@map("yearly_report")
}

model Monthly_report {
  month         DateTime       @id @db.Date
  income        Int            @default(0)
  outcome       Int            @default(0)
  profit        Int            @default(0)
  sold_quantity Int            @default(0)
  yearly_report Yearly_report  @relation(fields: [year], references: [year], onDelete: NoAction)
  year          DateTime       @db.Date
  Daily_report  Daily_report[]

  @@map("monthly_report")
}

model Daily_report {
  date           DateTime       @id @default(now()) @db.Date
  income         Int            @default(0)
  outcome        Int            @default(0)
  profit         Int            @default(0)
  sold_quantity  Int            @default(0)
  monthly_report Monthly_report @relation(fields: [month], references: [month], onDelete: NoAction)
  month          DateTime       @db.Date

  @@map("daily_report")
}

model Importing {
  id           Int             @id @default(autoincrement())
  date         DateTime        @default(now()) @db.Timestamptz(6)
  ImportDetail Import_detail[]

  @@map("importing")
}

model Import_detail {
  id           Int          @id @default(autoincrement())
  Product_item Product_item @relation(fields: [item], references: [id], onDelete: NoAction)
  item         Int
  quantity     Int          @default(0)
  price        Int          @default(0)
  import       Importing    @relation(fields: [importID], references: [id], onDelete: NoAction)
  importID     Int
  total_cost   Int          @default(0)

  @@map("import_detail")
}
